---
sidebar: sidebar 
permalink: use/protect-apps.html 
keywords: backup, back up, backup apps, back up apps, snapshots, snapshot an app, take a snapshot, take a backup, view backups, view snapshots, set policy, set schedule, schedule backups, schedule snapshots 
summary: 自動保護ポリシーまたはアドホックベースを使用してスナップショットやバックアップを作成することで、アプリケーションを保護します。 
---
= Snapshot とバックアップでアプリケーションを保護
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/use/


[role="lead"]
自動保護ポリシーまたはアドホックベースを使用して、スナップショットやバックアップを作成することで、すべてのアプリケーションを保護します。Astra Control Center UIまたはを使用できます https://docs.netapp.com/us-en/astra-automation/index.html["Astra Control API"^] アプリを保護します。

.このタスクについて
* * Helmでアプリケーションを展開*：Helmを使用してアプリケーションを展開する場合、Astra Control CenterにはHelmバージョン3が必要です。Helm 3 （または Helm 2 から Helm 3 にアップグレード）を使用して展開されたアプリケーションの管理とクローニングが完全にサポートされています。Helm 2 で展開されたアプリケーションはサポートされていません。
* *（OpenShiftクラスタのみ）ポリシーの追加*：OpenShiftクラスタでアプリをホストするためのプロジェクトを作成すると、プロジェクト（またはKubernetesネームスペース）にSecurityContext UIDが割り当てられます。Astra Control Center でアプリケーションを保護し、 OpenShift でそのアプリケーションを別のクラスタまたはプロジェクトに移動できるようにするには、アプリケーションを任意の UID として実行できるようにポリシーを追加する必要があります。たとえば、次の OpenShift CLI コマンドは、 WordPress アプリケーションに適切なポリシーを付与します。
+
`oc new-project wordpress`
`oc adm policy add-scc-to-group anyuid system:serviceaccounts:wordpress`
`oc adm policy add-scc-to-user privileged -z default -n wordpress`



アプリケーションデータの保護に関連する次のタスクを実行できます。

* <<保護ポリシーを設定します>>
* <<Snapshot を作成します>>
* <<バックアップを作成します>>
* <<Snapshot とバックアップを表示します>>
* <<Snapshot を削除します>>
* <<バックアップをキャンセルします>>
* <<バックアップを削除します>>




== 保護ポリシーを設定します

保護ポリシーは、定義されたスケジュールでスナップショット、バックアップ、またはその両方を作成することでアプリケーションを保護します。Snapshot とバックアップを毎時、日次、週次、および月単位で作成し、保持するコピーの数を指定できます。

1 時間に 1 回以上の頻度でバックアップや Snapshot を実行する必要がある場合は、次の方法があります https://docs.netapp.com/us-en/astra-automation/workflows/workflows_before.html["Astra Control REST API を使用して、スナップショットとバックアップを作成"^]。


TIP: バックアップとレプリケーションのスケジュールをオフセットして、スケジュールの重複を回避します。たとえば、1時間ごとに1時間の最上部にバックアップを実行し、オフセットを5分、間隔を10分に設定してレプリケーションを開始するようにスケジュールを設定します。


IMPORTANT: アプリケーションがでサポートされるストレージクラスを使用している場合 `ontap-nas-economy` ドライバ、保護ポリシーは使用できません。バックアップとSnapshotのスケジュールを設定する場合は、Astra Controlでサポートされるストレージクラスに移行します。

.手順
. 「 * アプリケーション」を選択し、アプリケーションの名前を選択します。
. [ * データ保護 * ] を選択します。
. ［ 保護ポリシーの設定 ］ を選択します。
. 毎時、日次、週次、および月単位で保持する Snapshot とバックアップの数を選択して、保護スケジュールを定義します。
+
スケジュールは、毎時、毎日、毎週、および毎月の各スケジュールで同時に定義できます。保持レベルを設定するまで、スケジュールはアクティブになりません。

+
バックアップの保持レベルを設定する際に、バックアップを格納するバケットを選択できます。

+
次の例では、 Snapshot とバックアップの保護スケジュールとして、毎時、毎日、毎週、毎月の 4 つを設定します。

+
image:screenshot-config-protection-policy.png["Snapshot とバックアップを毎時、毎日、毎週、または毎月作成する設定ポリシーの例のスクリーンショット。"]

. [* Review （レビュー） ] を選択します
. ［ * 保護ポリシーの設定 * ］ を選択します


.結果
Astra Control は、定義したスケジュールと保持ポリシーを使用して、スナップショットとバックアップを作成し、保持することによって、データ保護ポリシーを実装します。



== Snapshot を作成します

オンデマンド Snapshot はいつでも作成できます。


IMPORTANT: アプリケーションがでサポートされるストレージクラスを使用している場合 `ontap-nas-economy` ドライバ、スナップショットを作成できません。スナップショットには代替のストレージクラスを使用します。

.手順
. 「 * アプリケーション * 」を選択します。
. 目的のアプリケーションの * アクション * 列のオプションメニューから、 * スナップショット * を選択します。
. スナップショットの名前をカスタマイズし、*次へ*を選択します。
. Snapshot の概要を確認し、「 * Snapshot * 」を選択します。


.結果
スナップショットプロセスが開始されます。スナップショットは'ステータスが* Healthy *である場合に成功します（* Data protection *>* Snapshots *ページの* State *列）



== バックアップを作成します

アプリケーションはいつでもバックアップできます。


NOTE: Astra Control Center の S3 バケットは、使用可能容量を報告しません。Astra Control Center で管理されているアプリケーションのバックアップまたはクローニングを行う前に、 ONTAP または StorageGRID 管理システムでバケット情報を確認します。


IMPORTANT: アプリケーションがでサポートされるストレージクラスを使用している場合 `ontap-nas-economy` ドライバ。を定義していることを確認してください `backendType` のパラメータ https://docs.netapp.com/us-en/trident/trident-reference/objects.html#kubernetes-storageclass-objects["Kubernetesストレージオブジェクト"^] を使用します `ontap-nas-economy` 保護処理を実行する前にによってバックアップされたアプリケーションのバックアップ `ontap-nas-economy` システムの停止を伴うため、バックアップ処理が完了するまでアプリケーションを使用できなくなります。

.手順
. 「 * アプリケーション * 」を選択します。
. 目的のアプリケーションの*アクション*列のオプションメニューから、*バックアップ*を選択します。
. バックアップ名をカスタマイズする。
. 既存のスナップショットからアプリケーションをバックアップするかどうかを選択します。このオプションを選択すると、既存の Snapshot のリストから選択できます。
. ストレージバケットのリストから、バックアップのデスティネーションバケットを選択します。
. 「 * 次へ * 」を選択します。
. バックアップの概要を確認し、「バックアップ」を選択します。


.結果
Astra Control ：アプリケーションのバックアップを作成


NOTE: ネットワークに障害が発生している場合や、処理速度が異常に遅い場合は、バックアップ処理がタイムアウトする可能性があります。その結果、バックアップは失敗します。


NOTE: 実行中のバックアップをキャンセルする必要がある場合は、の手順に従ってください <<バックアップをキャンセルします>>。バックアップを削除するには、完了するまで待ってから、の手順を実行します <<バックアップを削除します>>。


NOTE: データ保護処理（クローン、バックアップ、リストア）が完了して永続ボリュームのサイズを変更したあと、新しいボリュームのサイズが UI に表示されるまでに最大 20 分かかります。データ保護処理にかかる時間は数分です。また、ストレージバックエンドの管理ソフトウェアを使用してボリュームサイズの変更を確認できます。



== Snapshot とバックアップを表示します

アプリケーションのスナップショットとバックアップは、 [ データ保護（ Data Protection ） ] タブで表示できます。

.手順
. 「 * アプリケーション」を選択し、アプリケーションの名前を選択します。
. [ * データ保護 * ] を選択します。
+
デフォルトでは、 Snapshot が表示されます。

. バックアップのリストを表示するには、「 * Backups * 」を選択します。




== Snapshot を削除します

不要になったスケジュール済みまたはオンデマンドの Snapshot を削除します。


NOTE: 現在レプリケート中のSnapshotは削除できません。

.手順
. 「 * アプリケーション」を選択し、管理アプリの名前を選択します。
. [ * データ保護 * ] を選択します。
. 目的のスナップショットの * アクション * 列のオプションメニューから、 * スナップショットの削除 * を選択します。
. 削除を確認するために「 delete 」と入力し、「 * はい、 Snapshot を削除します * 」を選択します。


.結果
Astra Control がスナップショットを削除します。



== バックアップをキャンセルします

実行中のバックアップをキャンセルすることができます。


TIP: バックアップをキャンセルするには、バックアップが実行されている必要があります `Running` 状態。にあるバックアップはキャンセルできません `Pending` 状態。

.手順
. 「 * アプリケーション」を選択し、アプリケーションの名前を選択します。
. [ * データ保護 * ] を選択します。
. 「 * Backups * 」を選択します。
. 目的のバックアップの[*アクション*（* Actions *）]列の[オプション（Options）]メニューから、[*キャンセル*（* Cancel *）]を選択します。
. 処理を確認するために「CANCEL」と入力し、「* Yes、cancel backup *」を選択します。




== バックアップを削除します

不要になったスケジュール済みまたはオンデマンドのバックアップを削除します。


NOTE: 実行中のバックアップをキャンセルする必要がある場合は、の手順に従ってください <<バックアップをキャンセルします>>。バックアップを削除するには、完了するまで待ってから、次の手順を実行します。

.手順
. 「 * アプリケーション」を選択し、アプリケーションの名前を選択します。
. [ * データ保護 * ] を選択します。
. 「 * Backups * 」を選択します。
. 目的のバックアップの [ * アクション * ] 列の [ オプション ] メニューから、 [ * バックアップの削除 * ] を選択します。
. 削除を確認するために「 delete 」と入力し、「 * はい、バックアップを削除 * 」を選択します。


.結果
Astra Control がバックアップを削除する。
